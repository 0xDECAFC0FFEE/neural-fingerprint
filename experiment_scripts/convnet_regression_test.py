# A simple script to check whether two implementations are equivalent.

import sys, os
import numpy.random as npr

from deepmolecule import get_data_file, load_data
from deepmolecule import build_convnet

from deepmolecule import tictoc

from autograd import grad

def main():

    os.environ['DATA_DIR'] = "/Users/dkd/repos/DeepMoleculesData/data"

    # Parameters for convolutional net.
    conv_arch_params = {'num_hidden_features' : [50, 50, 120],
                        'permutations' : True, 'pool_funcs':['softened_max', 'sum']}

    task_params = {'N_train'     : 200,
                   'target_name' : 'Log Rate',
                   'data_file'   : get_data_file('2014-11-03-all-tddft/processed.csv')}

    print "Conv net architecture params: ", conv_arch_params
    print "Task params", task_params

    print "\nLoading data..."
    (traindata, ) = load_data(task_params['data_file'], (task_params['N_train'],))
    train_inputs, train_targets = traindata['smiles'], traindata[task_params['target_name']]

    loss_fun, grad_fun1, pred_fun, hiddens_fun1, parser1 = build_convnet(**conv_arch_params)
    npr.seed(0)
    weights = npr.randn(parser1.N)

    with tictoc():
        print "Outputs: ", pred_fun(weights, train_inputs)

    with tictoc():
        print "Outputs: ", grad(loss_fun)(weights, train_inputs, train_targets)




if __name__ == '__main__':
    sys.exit(main())

"""Should produce:

Outputs:  [ 342.72036756  157.64595277  212.16603927  226.88063137  193.2024045
  187.37191471  113.03645313  386.73194299  214.59887118  178.17990544
  235.24821399  284.23841639   49.58930937  318.397687    195.79638165
  336.61622251  277.61710035  265.71407192  208.55485676  154.72836419
  423.15116465  109.78572468  311.23619392  185.48060364  204.04616839
  410.00562512  210.23913943  156.34982923  482.36064537  260.23797752
  166.5978075   181.72125329  300.05420862  178.56214267  164.56568704
  187.35073261  128.62528862  217.02890936  279.38985655   66.42315994
  362.97715771  414.97380392  120.67219791  157.20841516  147.08172488
  168.96651501  337.77982182   60.73987607  256.7334436   145.75663012
  156.81138689  256.35871944  347.57205293   78.25280308  200.26604557
  149.4811476   263.95495283  195.61391697  143.7331323   181.36811942
  435.57011574  249.34164029   84.06251248  432.86931381  164.78241944
  154.84641465  190.33532047  178.54116306  267.1748689   291.02873093
  356.06277266  331.89524785  234.76840927  246.7675272   264.42715268
  140.25210197  236.23172904  163.85256809  118.12585987  191.96719338
  246.51079256  332.93918596  290.58756173  217.84692247  171.53808204
  224.94159244  120.67764741  251.83222016  170.24789483   93.52566483
  223.51083796  242.23448961  226.3434994   184.61413327  144.99569063
  260.78709129  144.10044367  199.45960983  220.51680137   71.79507384
  227.12763764  578.7915059   121.1049069    77.85362731  276.76639167
  128.67800267  432.05132958  211.20157718  117.5691208   324.58972389
  322.8926419   237.82567162  125.94498803  349.39388945  400.44127397
  167.42549055  676.57487077  215.68845146  181.01583845  227.11779497
  207.31810845  287.24148502   54.78405482  212.70695438  199.31987773
  362.07572652  206.95221609  135.10091214  247.92347265  434.88052308
  265.25039221  202.94715864   85.99078835  187.62181073  286.20746323
   89.63425076  349.10000822   64.25005183  337.22123762  178.85207416
  306.31403726  236.59220971  212.23665992  175.41851625  362.64363163
   94.80151784  107.57555843  362.49387639  355.05448246  140.44986361
   61.53340557  132.21640657  255.5203501   501.44622023  206.5841264
  152.81527972  274.29076963  218.67898089  549.67905153  212.4318115
  184.83527048  198.46055743  196.92428821  433.0759103   113.0139976
  371.44277741  404.08406437  200.39849532  390.20408462  143.7344302
  188.96313883  277.80547829  214.05574464  160.38332564  176.23214385
  200.5698274   394.77982669  366.78378741  136.48356217  143.77074615
  131.45128178  132.80322863   67.18801642  129.71798887  210.4915985
  168.51191954  243.07418038  284.91154551  381.96931439  184.304434
  221.03084612  169.53376595  152.36709169  271.93940504   86.60668215
  177.25447366  195.60797921    7.13360212  349.820536    192.03279299]
"""
